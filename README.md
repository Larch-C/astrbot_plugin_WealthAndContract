# 财富与契约插件 v1.3

一款专为[AstrBot](https://astrbot.app/)设计的群聊插件，融合了经济系统、契约系统、道具系统、社交系统以及股票交易系统，为群聊提供丰富的互动玩法。

## ✨ 核心功能简介

### 📊 财富系统
- **每日签到**：获取金币奖励，连续签到有额外加成
- **银行存款**：每日1%利息，安全增值
- **金币转账**：支持用户间转账（收取10%手续费）
- **资产核查**：详细展示用户资产（现金、银行、牛牛金币）
- **打劫系统**：可打劫其他用户金币（25%失败率）
- **股票交易**：实时股票行情，买入卖出持仓管理

### ⛓️ 契约系统
- **契约买卖**：购买/出售其他用户作为契约伙伴
- **永久绑定**：使用特殊道具永久绑定契约关系
- **赎身功能**：支付1.5倍身价解除契约
- **契约关系**：可视化查看主人和契约伙伴关系
- **契约工作**：让契约伙伴工作赚钱（多种工作可选）

### 🧰 道具系统
- **签到商店**：购买各种道具（绑定道具、强制购买符等）
- **道具背包**：查看和管理已拥有的道具
- **道具使用**：使用道具实现特殊效果
- **礼物赠送**：赠送礼物增加好感度

### 💕 社交系统
- **约会系统**：发起约会邀请，触发随机事件
- **好感度系统**：根据好感度划分关系等级
- **特殊关系**：缔结恋人、兄弟、伙伴关系
- **社交活动**：多种社交事件（看电影、共进晚餐等）
- **强制社交**：使用特殊道具强制进行社交

### 📈 股票系统（全新升级）
- **实时行情**：15只不同特性的股票
- **趋势模拟**：上涨、下跌、盘整、随机波动四种趋势
- **持仓管理**：查看股票持仓及盈亏情况
- **波动率机制**：不同股票有不同风险等级
- **黑天鹅事件**：0.1%概率发生极端波动（暴涨/暴跌）
- **交易时间**：8:00-18:00（仅交易时间可操作）
- **一键抛售**：快速卖出所有或指定股票

### 🛡️ 管理系统
- **授权系统**：4级管理员权限（查阅、股票、操作、数据）
- **黑名单系统**：拉黑用户或群聊拒绝响应
- **数据管理**：添加/删除金币、道具、好感度等
- **强制操作**：强制约会、社交、股票操作等

## 📁 项目结构

```
Astrbot/
    │-- data/                    # 数据存储目录
        │-- plugins_WealthAndContract_data/
            │-- WAC_data.yml        # 主数据文件
            │-- WAC_propdata.yml    # 道具数据文件
            │-- WAC_social_data.yml # 社交数据文件
            │-- WAC_time_data.yml   # 时间数据文件
            │-- stock_data.yml      # 股票数据文件
            │-- stock_user_data.yml # 用户股票数据文件
            │-- blacklist_data.yml  # 黑名单数据文件
        |-- plugins/
            │-- astrbot_plugin_wealthandcontract/
                │-- main.py                  # 插件主程序
                │-- metadata.yaml            # 插件元数据
                |-- README.md                # 插件说明
                |-- _conf_schema.json        # 插件可配置数据
                │-- requirements.txt         # 依赖列表
                │-- 喵呜可爱字.ttf            # 字体文件
                │-- images/                  # 图片缓存目录
```

## 📜 使用说明

1. **安装依赖**：
   ```bash
   pip install pytz pillow httpx pyyaml
   ```

2. **安装插件**：
   - 将插件文件夹放入AstrBot的`data/plugins`目录
   - 重启AstrBot

3. **数据目录**：
   - 确保`data/plugins_WealthAndContract_data`目录有写入权限
   - 首次运行会自动创建数据文件

4. **字体文件**：
   - 确保`喵呜可爱字.ttf`字体文件存在
   - 用于生成图文卡片

5. **使用命令**：
   - 在群聊中使用`/签到帮助`查看详细帮助
   - 管理员使用`/WACadmin help`查看管理员帮助
   - 授权用户使用`/WACadmin-us help`查看可用命令

## 📌 注意事项

1. **数据安全**：
   - 定期备份`plugins_WealthAndContract_data`目录
   - 插件更新时可能需重置数据

2. **权限要求**：
   - 部分命令需要群管理员权限
   - 授权系统需谨慎使用

3. **依赖安装**：
   - 确保安装所有必需依赖
   - 缺少依赖可能导致功能异常

4. **资源消耗**：
   - 股票刷新每3分钟一次（交易时间内）
   - 邀请清理每5分钟一次
   - 高活跃群聊可能增加资源消耗

5. **兼容性**：
   - 与`astrbot_plugin_Qsign`插件不兼容
   - 避免同时安装

6. **敏感操作**：
   - 删除用户/清空数据需二次确认
   - 谨慎使用管理员命令

## 奇奇怪怪的冲突
- 与[astrbot 图片外显插件](https://github.com/Zhalslar/astrbot_plugin_image_summary)同时安装可能导致插件无法发出第二张图片

## ✨ 特别鸣谢

- 本插件基于[二次元签到插件](https://github.com/zgojin/astrbot_plugin_Qsign)进行扩展开发
- 灵感来源于[Astr超级市场](https://github.com/0d00-Ciallo-0721/astrbot_plugin_Astrsupermarket)
- 搭配[娱乐插件](https://github.com/WUHINS/astrbot_plugin_niuniu)食用更佳✨

---

**v1.3 更新内容**：  
- **股票系统全面升级**：
  - 添加黑天鹅事件（0.1%概率发生极端波动）
  - 波动率随机变化机制（50%概率变化）
  - 交易时间限制（8:00-18:00）
  - 一键抛售功能（/抛售 [股票名]）
  - 卖出股票收取1%手续费
- **命令优化**：
  - 简化命令格式（如拉黑用户不再需要群号）
  - 管理员帮助信息更新
  - 授权用户命令优化
- **数据管理增强**：
  - 删除用户/群聊时清理股票数据
  - 黑名单系统优化
  - 错误处理机制完善
- **稳定性提升**：
  - 修复多个已知问题
  - 优化后台任务管理
  - 增强数据持久化

**提示**：  
- 命令详情请输入`/签到帮助`查看完整列表  
- 管理员命令请输入`/WACadmin help`查看  
- 授权用户命令请输入`/WACadmin-us help`查看  
- 如有问题请加Q群反馈：1040048381  

祝您使用愉快！探索更多有趣的群聊互动方式~ 💖

> **免责声明**：本插件内容纯属娱乐性质，所有称呼与词汇均为虚构，不涉及任何现实政治敏感内容。